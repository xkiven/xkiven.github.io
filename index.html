
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>xkiven ã® å°å±‹</title>
    <meta name="author" content="xkiven" />
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/ly.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>


<script src="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/highlightjs-line-numbers.js/2.8.0/highlightjs-line-numbers.min.js"></script>
<link
    rel="stylesheet"
    href="https://s4.zstatic.net/ajax/libs/highlight.js/11.9.0/styles/github.min.css"
/>
<script src="/js/lib/highlight.js"></script>


<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.js"></script>
<script src="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/contrib/auto-render.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/KaTeX/0.16.9/katex.min.css" />
<script src="/js/lib/math.js"></script>


<script src="/js/lib/preview.js"></script>





<script src="/js/lib/home.js"></script>

<link rel="stylesheet" href="/css/main.css" />

<meta name="generator" content="Hexo 7.3.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2>LOADING</h2>
                    <p>åŠ è½½è¿‡æ…¢è¯·å¼€å¯ç¼“å­˜ æµè§ˆå™¨é»˜è®¤å¼€å¯</p>
                    <img src="/images/loading.gif" />
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>XKIVEN ã® å°å±‹</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/about">
            <i class="fa-solid fa-id-card fa-fw"></i>
            <span>&ensp;About</span>
        </a>
        
        <a href="/archives">
            <i class="fa-solid fa-box-archive fa-fw"></i>
            <span>&ensp;Archives</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;XKIVEN ã® å°å±‹</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/about">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-id-card fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">About</div>
                    </div>
                </a>
                
                <a href="/archives">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-box-archive fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Archives</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <div id="home-head">
    <div
        id="home-background"
        ref="homeBackground"
        data-images="/images/background2.jpg"
    ></div>
    <div id="home-info" @click="homeClick">
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="loop"></span>
        <span class="info">
            <div class="wrap">
                <h1>xkiven ã® å°å±‹</h1>
                <h3>here is xkiven...</h3>
                <h5></h5>
            </div>
        </span>
    </div>
</div>
<div
    id="home-posts-wrap"
    ref="homePostsWrap"
    true
>
    <div id="home-posts">
        

<div class="post">
    <a href="/2025/02/12/nope-net/">
        <h2 class="post-title">nope_net</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/2/12
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="Nope-Net"><a href="#Nope-Net" class="headerlink" title="Nope_Net"></a>Nope_Net</h1><ul>
<li><p>*ç›®å‰çš„æƒ³æ³•æ˜¯åˆ†ä¸ºä¸¤ä¸ªæ¿å—ï¼Œä¸€ä¸ªæ˜¯æ¨é€å¸–å­ï¼Œå¯ä»¥å‘å¸ƒå¸–å­ï¼Œå¯ä»¥è¿›è¡Œå®æ—¶è¯„è®ºï¼Œæœ‰æµè§ˆé‡è®¾ç½®ï¼Œä»¥æ­¤å¯ä»¥æ¨é€æµè§ˆé‡é«˜çš„å¸–å­ï¼Œä¸€ä¸ªæ˜¯ä»»åŠ¡æ¿å—ï¼Œå¯ä»¥è®°å½•ä¸ªäººä¸€æ®µæ—¶é—´å†…çš„ä»»åŠ¡ï¼Œå¯ä»¥æŸ¥çœ‹å®Œæˆæƒ…å†µï¼Œå¯ä»¥è®¾ç½®æœŸé™ï¼Œæ—¶é—´åˆ°äº†å¯ä»¥æœ‰æé†’ã€‚</p>
</li>
<li><p>*** é¡¹ç›®åœ°å€ï¼š<a target="_blank" rel="noopener" href="https://github.com/xkiven/rope_net/tree/master">xkiven&#x2F;rope_net åœ¨ master</a>***</p>
</li>
</ul>
<h2 id="ç”¨æˆ·"><a href="#ç”¨æˆ·" class="headerlink" title="ç”¨æˆ·"></a>ç”¨æˆ·</h2><h3 id="ç”¨æˆ·çš„æ³¨å†Œä¸ç™»å½•"><a href="#ç”¨æˆ·çš„æ³¨å†Œä¸ç™»å½•" class="headerlink" title="ç”¨æˆ·çš„æ³¨å†Œä¸ç™»å½•"></a>ç”¨æˆ·çš„æ³¨å†Œä¸ç™»å½•</h3><p>ä½¿ç”¨EmailéªŒè¯ç ï¼ŒåŠ å¼ºç™»å½•å®‰å…¨ï¼Œå¹¶ç”Ÿæˆéšæœºtokenä»¤ç‰Œ,åŠ å…¥tokenæœ‰æ•ˆæœŸ</p>
<h2 id="å¸–å­"><a href="#å¸–å­" class="headerlink" title="å¸–å­"></a>å¸–å­</h2><h3 id="å¸–å­çš„å‘è¡¨"><a href="#å¸–å­çš„å‘è¡¨" class="headerlink" title="å¸–å­çš„å‘è¡¨"></a>å¸–å­çš„å‘è¡¨</h3><p>éªŒè¯tokenï¼Œå‘å¸ƒå¸–å­ï¼Œå‚¨å­˜å¸–å­ä¸»äººçš„ç”¨æˆ·IDä»¥åŠå‘å¸ƒæ—¶é—´ï¼Œå°†æµè§ˆé‡è®¾ä¸ºé›¶ã€‚</p>
<h3 id="å¾—åˆ°å¸–å­è¯¦æƒ…"><a href="#å¾—åˆ°å¸–å­è¯¦æƒ…" class="headerlink" title="å¾—åˆ°å¸–å­è¯¦æƒ…"></a>å¾—åˆ°å¸–å­è¯¦æƒ…</h3><p>æ— éœ€éªŒè¯tokenï¼ŒæŸ¥çœ‹å¸–å­çš„è¯¦ç»†ä¿¡æ¯ï¼Œå¹¶å¢åŠ æµè§ˆé‡</p>
<h3 id="åˆ é™¤å¸–å­"><a href="#åˆ é™¤å¸–å­" class="headerlink" title="åˆ é™¤å¸–å­"></a>åˆ é™¤å¸–å­</h3><p>éªŒè¯token,éªŒè¯æ˜¯å¦ä¸ºå¸–å­çš„ä¸»äººï¼Œåˆ é™¤æ‰€æœ‰å¸–å­æ•°æ®</p>
<h3 id="æ ¹æ®å¸–å­çš„æµè§ˆé‡ï¼Œå¾—åˆ°å¸–å­åˆ—è¡¨"><a href="#æ ¹æ®å¸–å­çš„æµè§ˆé‡ï¼Œå¾—åˆ°å¸–å­åˆ—è¡¨" class="headerlink" title="æ ¹æ®å¸–å­çš„æµè§ˆé‡ï¼Œå¾—åˆ°å¸–å­åˆ—è¡¨"></a>æ ¹æ®å¸–å­çš„æµè§ˆé‡ï¼Œå¾—åˆ°å¸–å­åˆ—è¡¨</h3><p>æ— éœ€éªŒè¯tokenï¼Œå¾—åˆ°æ‰€æœ‰å¸–å­ï¼Œå¹¶ä¸”æ ¹æ®æµè§ˆé‡æ’åº</p>
<h2 id="è¯„è®º"><a href="#è¯„è®º" class="headerlink" title="è¯„è®º"></a>è¯„è®º</h2><h3 id="å¸–å­è¯„è®ºçš„å®æ—¶æ›´æ–°"><a href="#å¸–å­è¯„è®ºçš„å®æ—¶æ›´æ–°" class="headerlink" title="å¸–å­è¯„è®ºçš„å®æ—¶æ›´æ–°"></a>å¸–å­è¯„è®ºçš„å®æ—¶æ›´æ–°</h3><p>éªŒè¯token,ä½¿ç”¨WebSocket,å®ç°å®æ—¶æ›´æ–°è¯„è®º</p>
<h3 id="åµŒå¥—è¯„è®º"><a href="#åµŒå¥—è¯„è®º" class="headerlink" title="åµŒå¥—è¯„è®º"></a>åµŒå¥—è¯„è®º</h3><p>åµŒå¥—è¯„è®ºåªéœ€è¦å®ç°å­˜å…¥æ•°æ®åº“ï¼Œæ— éœ€å®æ—¶ï¼Œä¸”åªç”¨ä¸€å±‚å¾ªç¯ï¼Œå®ç°åŸºæœ¬å¢åˆ æŸ¥ã€‚</p>
<h2 id="ä»»åŠ¡"><a href="#ä»»åŠ¡" class="headerlink" title="ä»»åŠ¡"></a>ä»»åŠ¡</h2><h3 id="å‘å¸ƒä¸åˆ é™¤ä»»åŠ¡"><a href="#å‘å¸ƒä¸åˆ é™¤ä»»åŠ¡" class="headerlink" title="å‘å¸ƒä¸åˆ é™¤ä»»åŠ¡"></a>å‘å¸ƒä¸åˆ é™¤ä»»åŠ¡</h3><p>éªŒè¯token,éœ€è¦è§„å®šæˆªæ­¢æ—¶é—´ï¼Œå¦‚æœä»»åŠ¡æ²¡æœ‰å®Œæˆï¼Œä¸èƒ½åˆ é™¤</p>
<h3 id="æ£€æŸ¥ä»»åŠ¡å®Œæˆæƒ…å†µ"><a href="#æ£€æŸ¥ä»»åŠ¡å®Œæˆæƒ…å†µ" class="headerlink" title="æ£€æŸ¥ä»»åŠ¡å®Œæˆæƒ…å†µ"></a>æ£€æŸ¥ä»»åŠ¡å®Œæˆæƒ…å†µ</h3><p>éªŒè¯token,ä½¿ç”¨WebSocketï¼Œæ¯åˆ†é’Ÿåœ¨æœåŠ¡å™¨ç«¯æŸ¥çœ‹ä¸€æ¬¡ï¼Œå¦‚æœå‘ç°æœ‰ä»»åŠ¡æ—¶é—´å·²ç»æˆªæ­¢ï¼Œç«‹å³åé¦ˆ</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/02/12/nope-net/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2025/02/04/chat-room-1/">
        <h2 class="post-title">chat_room</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/2/4
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h1 id="åœ¨çº¿èŠå¤©å®¤"><a href="#åœ¨çº¿èŠå¤©å®¤" class="headerlink" title="åœ¨çº¿èŠå¤©å®¤"></a>åœ¨çº¿èŠå¤©å®¤</h1><h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a>é¡¹ç›®ç®€ä»‹</h2><p>â€‹	åŸºäºwebsocketçš„ç®€å•åœ¨çº¿èŠå¤©å®¤ï¼Œä»…å®ç°å®æ—¶æ¥å—æ–‡å­—å¹¶è¿”å›æ‰€æœ‰å®¢æˆ·ç«¯çš„åŠŸèƒ½ï¼Œæ²¡æœ‰æ·»åŠ æ³¨å†Œä¸ç™»å½•ï¼Œå‘é€æ¶ˆæ¯æ—¶çš„åå­—å¯ä»¥éšæ—¶è‡ªå·±æ”¹å˜ã€‚</p>
<h2 id="é¡¹ç›®å†…å®¹"><a href="#é¡¹ç›®å†…å®¹" class="headerlink" title="é¡¹ç›®å†…å®¹"></a>é¡¹ç›®å†…å®¹</h2><h3 id="æ•°æ®åº“ç›¸å…³"><a href="#æ•°æ®åº“ç›¸å…³" class="headerlink" title="æ•°æ®åº“ç›¸å…³"></a>æ•°æ®åº“ç›¸å…³</h3><p>ä½¿ç”¨mysqlå­˜å‚¨ç”¨æˆ·çš„å‘å‡ºçš„ä¿¡æ¯ä»¥åŠå‘å‡ºè€…çš„ä¿¡æ¯</p>
<ul>
<li>Init</li>
</ul>
<pre><code class="go">package main

import (
    &quot;database/sql&quot;
    &quot;fmt&quot;
    _ &quot;github.com/go-sql-driver/mysql&quot;
)

var db *sql.DB

func InitDB() &#123;
    var err error

    db, err = sql.Open(&quot;mysql&quot;, &quot;root:********@tcp(127.0.0.1:3306)/chatroom?parseTime=true&quot;)
    if err != nil &#123;
        panic(err.Error())
    &#125;
    err = db.Ping()
    if err != nil &#123;
        panic(err.Error())
    &#125;
    fmt.Println(&quot;Successfully connected to mysql&quot;)

&#125;
</code></pre>
<ul>
<li>å­˜å’Œå‡º</li>
</ul>
<pre><code class="go">package main

import (
    &quot;database/sql&quot;
    &quot;fmt&quot;
)

type Message struct &#123;
    ID       int
    Username string
    Message  string
&#125;

func saveMessage(db *sql.DB, username, message string) error &#123;
    stmt, err := db.Prepare(&quot;INSERT INTO message(username,message) VALUES(?,?)&quot;)
    if err != nil &#123;
        return err
    &#125;
    defer stmt.Close()
    _, err = stmt.Exec(username, message)
    if err != nil &#123;
        return err
    &#125;
    fmt.Printf(&quot;message saved: %s-%s\n&quot;, username, message)
    return nil
&#125;

func getMessage(db *sql.DB) ([]Message, error) &#123;
    rows, err := db.Query(&quot;SELECT id,username,message FROM messages&quot;)
    if err != nil &#123;
        return nil, err
    &#125;
    defer rows.Close()

    var messages []Message
    for rows.Next() &#123;
        var msg Message
        err := rows.Scan(&amp;msg.ID, &amp;msg.Username, &amp;msg.Message)
        if err != nil &#123;
            return nil, err
        &#125;
        messages = append(messages, msg)
    &#125;
    if err = rows.Err(); err != nil &#123;
        return nil, err
    &#125;
    return messages, nil

&#125;
</code></pre>
<h3 id="websocketç›¸å…³"><a href="#websocketç›¸å…³" class="headerlink" title="websocketç›¸å…³"></a>websocketç›¸å…³</h3><h4 id="å®šä¹‰-WebSocket-å‡çº§å™¨"><a href="#å®šä¹‰-WebSocket-å‡çº§å™¨" class="headerlink" title="å®šä¹‰ WebSocket å‡çº§å™¨"></a>å®šä¹‰ WebSocket å‡çº§å™¨</h4><pre><code class="go">var upgrader = websocket.Upgrader&#123;
    ReadBufferSize:  1024,
    WriteBufferSize: 1024,
    CheckOrigin: func(r *http.Request) bool &#123;
        return true
    &#125;,
&#125;
</code></pre>
<ul>
<li><code>ReadBufferSize</code> å’Œ <code>WriteBufferSize</code>ï¼šåˆ†åˆ«æŒ‡å®šäº†è¯»å–å’Œå†™å…¥ WebSocket æ¶ˆæ¯æ—¶ä½¿ç”¨çš„ç¼“å†²åŒºå¤§å°ã€‚</li>
<li><code>CheckOrigin</code>ï¼šæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºæ£€æŸ¥å®¢æˆ·ç«¯è¯·æ±‚çš„æ¥æºæ˜¯å¦å…è®¸ã€‚è¿™é‡Œç®€å•åœ°è¿”å› <code>true</code>ï¼Œè¡¨ç¤ºå…è®¸æ‰€æœ‰æ¥æºçš„è¯·æ±‚ã€‚</li>
</ul>
<h4 id="å®šä¹‰è¿æ¥åˆ—è¡¨"><a href="#å®šä¹‰è¿æ¥åˆ—è¡¨" class="headerlink" title="å®šä¹‰è¿æ¥åˆ—è¡¨"></a>å®šä¹‰è¿æ¥åˆ—è¡¨</h4><pre><code class="go">var connections = make([]*websocket.Conn, 0)
</code></pre>
<ul>
<li><code>connections</code> æ˜¯ä¸€ä¸ªåˆ‡ç‰‡ï¼Œç”¨äºå­˜å‚¨æ‰€æœ‰è¿æ¥åˆ°æœåŠ¡å™¨çš„ WebSocket è¿æ¥ã€‚æ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘ <code>websocket.Conn</code> ç±»å‹çš„æŒ‡é’ˆï¼Œè¯¥ç±»å‹è¡¨ç¤ºä¸€ä¸ª WebSocket è¿æ¥ã€‚</li>
</ul>
<h4 id="å¤„ç†-WebSocket-è¿æ¥çš„å‡½æ•°"><a href="#å¤„ç†-WebSocket-è¿æ¥çš„å‡½æ•°" class="headerlink" title="å¤„ç† WebSocket è¿æ¥çš„å‡½æ•°"></a>å¤„ç† WebSocket è¿æ¥çš„å‡½æ•°</h4><pre><code class="go">func serveWs(w http.ResponseWriter, r *http.Request) &#123;
    conn, err := upgrader.Upgrade(w, r, nil)
    if err != nil &#123;
        log.Println(err)
        return
    &#125;
    defer conn.Close()

    connections = append(connections, conn)
</code></pre>
<ul>
<li><code>serveWs</code> å‡½æ•°ç”¨äºå¤„ç†å®¢æˆ·ç«¯çš„ WebSocket è¿æ¥è¯·æ±‚ã€‚</li>
<li><code>upgrader.Upgrade(w, r, nil)</code>ï¼šå°† HTTP è¿æ¥å‡çº§ä¸º WebSocket è¿æ¥ã€‚å¦‚æœå‡çº§æˆåŠŸï¼Œè¿”å›ä¸€ä¸ª <code>websocket.Conn</code> ç±»å‹çš„è¿æ¥å¯¹è±¡ï¼›å¦‚æœå¤±è´¥ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ã€‚</li>
<li><code>defer conn.Close()</code>ï¼šç¡®ä¿åœ¨å‡½æ•°è¿”å›æ—¶å…³é—­ WebSocket è¿æ¥ã€‚</li>
<li><code>connections = append(connections, conn)</code>ï¼šå°†æ–°çš„ WebSocket è¿æ¥æ·»åŠ åˆ° <code>connections</code> åˆ‡ç‰‡ä¸­ã€‚</li>
</ul>
<h4 id="å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯"><a href="#å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯" class="headerlink" title="å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯"></a>å¾ªç¯è¯»å–å®¢æˆ·ç«¯æ¶ˆæ¯</h4><pre><code class="go">    for &#123;
        var msg struct &#123;
            Username string `json:&quot;username&quot;`
            Message  string `json:&quot;message&quot;`
        &#125;
        err := conn.ReadJSON(&amp;msg)
        if err != nil &#123;
            if websocket.IsUnexpectedCloseError(err, websocket.CloseGoingAway, websocket.CloseAbnormalClosure) &#123;
                log.Println(&quot;error:&quot;, err)
            &#125;
            for i, c := range connections &#123;
                if c == conn &#123;
                    connections = append(connections[:i], connections[i+1:]...)
                    break
                &#125;
            &#125;
            break
        &#125;
</code></pre>
<ul>
<li><code>var msg struct &#123;...&#125;</code>ï¼šå®šä¹‰ä¸€ä¸ªåŒ¿åç»“æ„ä½“ï¼Œç”¨äºå­˜å‚¨ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°çš„ JSON æ¶ˆæ¯ã€‚ç»“æ„ä½“çš„å­—æ®µ <code>Username</code> å’Œ <code>Message</code> åˆ†åˆ«å¯¹åº” JSON æ•°æ®ä¸­çš„ <code>username</code> å’Œ <code>message</code> å­—æ®µã€‚</li>
<li><code>conn.ReadJSON(&amp;msg)</code>ï¼šä» WebSocket è¿æ¥ä¸­è¯»å– JSON æ•°æ®ï¼Œå¹¶å°†å…¶è§£æåˆ° <code>msg</code> ç»“æ„ä½“ä¸­ã€‚</li>
<li>å¦‚æœè¯»å–è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œæ£€æŸ¥æ˜¯å¦æ˜¯æ„å¤–å…³é—­é”™è¯¯ï¼ˆå¦‚å®¢æˆ·ç«¯å¼‚å¸¸æ–­å¼€è¿æ¥ï¼‰ã€‚å¦‚æœæ˜¯ï¼Œåˆ™è®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä» <code>connections</code> åˆ‡ç‰‡ä¸­ç§»é™¤è¯¥è¿æ¥ã€‚</li>
</ul>
<h4 id="ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®"><a href="#ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®" class="headerlink" title="ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®"></a>ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®</h4><pre><code class="go">        //ä¿å­˜æ¶ˆæ¯åˆ°æ•°æ®åº“
        err = saveMessage(db, msg.Username, msg.Message)
        if err != nil &#123;
            log.Println(err)
        &#125;
</code></pre>
<ul>
<li><code>saveMessage</code> å‡½æ•°ç”¨äºå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä¿å­˜åˆ°æ•°æ®åº“ä¸­ã€‚ä½†ä»£ç ä¸­ <code>db</code> å˜é‡æœªå®šä¹‰ï¼Œéœ€è¦å…ˆå»ºç«‹æ•°æ®åº“è¿æ¥å¹¶åˆå§‹åŒ– <code>db</code>ã€‚åŒæ—¶ï¼Œ<code>saveMessage</code> å‡½æ•°ä¹Ÿæœªç»™å‡ºå®ç°ï¼Œéœ€è¦è‡ªè¡Œå®ç°è¯¥å‡½æ•°ã€‚</li>
</ul>
<h4 id="å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯"><a href="#å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯" class="headerlink" title="å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯"></a>å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯</h4><pre><code class="go">        //å¹¿æ’­æ¶ˆæ¯ç»™æ‰€æœ‰è¿æ¥çš„å®¢æˆ·ç«¯
        for _, c := range connections &#123;
            err = c.WriteJSON(msg)
            if err != nil &#123;
                log.Println(err)
                for i, con := range connections &#123;
                    if con == c &#123;
                        connections = append(connections[:i], connections[i+1:]...)
                        break
                    &#125;
                &#125;
            &#125;
        &#125;
    &#125;
&#125;
</code></pre>
<ul>
<li><code>c.WriteJSON(msg)</code>ï¼šå°†æ¥æ”¶åˆ°çš„æ¶ˆæ¯ä»¥ JSON æ ¼å¼å‘é€ç»™æ¯ä¸ªè¿æ¥çš„å®¢æˆ·ç«¯ã€‚</li>
<li>å¦‚æœå‘é€è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯ï¼Œè®°å½•é”™è¯¯ä¿¡æ¯ï¼Œå¹¶ä» <code>connections</code> åˆ‡ç‰‡ä¸­ç§»é™¤è¯¥è¿æ¥ã€‚</li>
</ul>
<h2 id="APIæ¥å£"><a href="#APIæ¥å£" class="headerlink" title="APIæ¥å£"></a>APIæ¥å£</h2><pre><code class="go">package main

import (
    &quot;github.com/gin-gonic/gin&quot;
    &quot;net/http&quot;
)

func SetupRoutes(r *gin.Engine) &#123;
    r.GET(&quot;/ws&quot;, func(c *gin.Context) &#123;
        serveWs(c.Writer, c.Request)
    &#125;)

    r.GET(&quot;/messages&quot;, func(c *gin.Context) &#123;
        message, err := getMessage(db)
        if err != nil &#123;
            c.JSON(http.StatusInternalServerError, gin.H&#123;
                &quot;error&quot;: &quot;å°è¯•ä»æœåŠ¡å™¨è·å–æ•°æ®æ—¶å‘ç”Ÿäº†é”™è¯¯&quot;,
            &#125;)
            return
        &#125;
        c.JSON(http.StatusOK, message)
    &#125;)
&#125;
</code></pre>
<h2 id="ä¸»å‡½æ•°"><a href="#ä¸»å‡½æ•°" class="headerlink" title="ä¸»å‡½æ•°"></a>ä¸»å‡½æ•°</h2><pre><code class="go">package main

import &quot;github.com/gin-gonic/gin&quot;

func main() &#123;
    InitDB()
    r := gin.Default()
    SetupRoutes(r)
    r.Run(&quot;:8080&quot;)
&#125;
</code></pre>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/02/04/chat-room-1/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2025/02/02/something/">
        <h2 class="post-title">something</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/2/2
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <ol>
<li>å®‰è£…Ginï¼šåœ¨é¡¹ç›®ç›®å½•ä¸‹çš„ç»ˆç«¯ä¸­è¿è¡Œ  go get -u github.com&#x2F;gin-gonic&#x2F;gin ã€‚ -u  æ ‡å¿—ç”¨äºæ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬ã€‚</li>
<li>å®‰è£…MySQLé©±åŠ¨ï¼šæ‰§è¡Œ  go get -u github.com&#x2F;go-sql-driver&#x2F;mysql ã€‚è¿™ä¼šä¸‹è½½MySQLé©±åŠ¨åˆ°ä½ çš„æœ¬åœ° $GOPATH ä¸‹ã€‚</li>
<li>å®‰è£…WebSocketåº“ï¼šè‹¥ä½¿ç”¨  gorilla&#x2F;websocket ï¼ˆæ¯”  golang.org&#x2F;x&#x2F;net&#x2F;websocket  æ›´å¸¸ç”¨ ï¼‰ï¼Œè¿è¡Œ  go get -u github.com&#x2F;gorilla&#x2F;websocket ã€‚</li>
<li>å®‰è£…gorm:     æ‰§è¡Œgo get -u gorm.io&#x2F;gormï¼Œ go get -u gorm.io&#x2F;driver&#x2F;mysql</li>
<li>sshå¯†é’¥ï¼šssh-keygen -t rsa -b 4096 -Câ€<a href="mailto:&#50;&#x36;&#55;&#52;&#x33;&#48;&#x32;&#52;&#51;&#51;&#64;&#113;&#113;&#46;&#99;&#x6f;&#x6d;">&#50;&#x36;&#55;&#52;&#x33;&#48;&#x32;&#52;&#51;&#51;&#64;&#113;&#113;&#46;&#99;&#x6f;&#x6d;</a>â€œ</li>
<li>sshkmftymkzpecee</li>
<li>å®‰è£… Go - zero ä»£ç ç”Ÿæˆå·¥å…· goctlï¼šgo install github.com&#x2F;zeromicro&#x2F;go-zero&#x2F;tools&#x2F;goctl@latest</li>
</ol>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/02/02/something/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2025/01/26/RedRock_commerce/">
        <h2 class="post-title">&#39;RedRock commerce&#39;</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/1/26
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <h2 id="é¡¹ç›®ç®€ä»‹"><a href="#é¡¹ç›®ç®€ä»‹" class="headerlink" title="é¡¹ç›®ç®€ä»‹"></a><strong>é¡¹ç›®ç®€ä»‹</strong></h2><p>æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº Go è¯­è¨€å’Œ Gin æ¡†æ¶å¼€å‘,å€ŸåŠ©go-cacheåº“å®ç°ç¼“å­˜æœºåˆ¶çš„ç”µå•† API ç³»ç»Ÿï¼Œæä¾›äº†ç”¨æˆ·ç®¡ç†ã€å•†å“æŸ¥è¯¢ã€å•†å“è¯„è®ºã€è´­ç‰©è½¦ç­‰åŠŸèƒ½ã€‚é€šè¿‡è¿™äº› APIï¼Œå¼€å‘è€…å¯ä»¥æ„å»ºç”µå•†åº”ç”¨çš„åç«¯æœåŠ¡ï¼Œå®ç°ç”¨æˆ·ä¸å•†å“çš„äº¤äº’æ“ä½œã€‚</p>
<p><em><strong>é¡¹ç›®åœ°å€</strong></em>ï¼š<a target="_blank" rel="noopener" href="https://github.com/xkiven/redrock-commerce/tree/master">xkiven&#x2F;redrock-commerce at master</a></p>
<h2 id="æŠ€æœ¯æ ˆ"><a href="#æŠ€æœ¯æ ˆ" class="headerlink" title="æŠ€æœ¯æ ˆ"></a><strong>æŠ€æœ¯æ ˆ</strong></h2><ul>
<li><p>ç¼–ç¨‹è¯­è¨€ï¼šGo è¯­è¨€</p>
</li>
<li><p>Web æ¡†æ¶ï¼šGin</p>
</li>
<li><p>æ•°æ®åº“ï¼šMySQL</p>
</li>
<li><p>ç¼“å­˜ï¼šgo - cache</p>
</li>
</ul>
<h2 id="æ¥å£è¯´æ˜"><a href="#æ¥å£è¯´æ˜" class="headerlink" title="æ¥å£è¯´æ˜"></a><strong>æ¥å£è¯´æ˜</strong></h2><h3 id="ç”¨æˆ·ç›¸å…³"><a href="#ç”¨æˆ·ç›¸å…³" class="headerlink" title="ç”¨æˆ·ç›¸å…³"></a>ç”¨æˆ·ç›¸å…³</h3><h4 id="ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼š"><a href="#ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼š" class="headerlink" title="ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼š"></a>ä¿®æ”¹ç”¨æˆ·ä¿¡æ¯ï¼š</h4><p>- </p>
<h4 id="ç™»å½•è·å–-tokenï¼š"><a href="#ç™»å½•è·å–-tokenï¼š" class="headerlink" title="ç™»å½•è·å– tokenï¼š"></a>ç™»å½•è·å– tokenï¼š</h4><p>- </p>
<h4 id="æ³¨å†Œæ–°ç”¨æˆ·ï¼š"><a href="#æ³¨å†Œæ–°ç”¨æˆ·ï¼š" class="headerlink" title="æ³¨å†Œæ–°ç”¨æˆ·ï¼š"></a>æ³¨å†Œæ–°ç”¨æˆ·ï¼š</h4><p>- </p>
<h4 id="æ›´æ–°token"><a href="#æ›´æ–°token" class="headerlink" title="æ›´æ–°token:"></a>æ›´æ–°token:</h4><p>- </p>
<h3 id="å•†å“ç›¸å…³"><a href="#å•†å“ç›¸å…³" class="headerlink" title="å•†å“ç›¸å…³"></a>å•†å“ç›¸å…³</h3><h4 id="æœç´¢å•†å“ï¼š"><a href="#æœç´¢å•†å“ï¼š" class="headerlink" title="æœç´¢å•†å“ï¼š"></a>æœç´¢å•†å“ï¼š</h4><p>- </p>
<h4 id="è·å–å•†å“åˆ—è¡¨ï¼š"><a href="#è·å–å•†å“åˆ—è¡¨ï¼š" class="headerlink" title="è·å–å•†å“åˆ—è¡¨ï¼š"></a>è·å–å•†å“åˆ—è¡¨ï¼š</h4><p>- </p>
<h4 id="æŸ¥çœ‹åˆ†ç±»ä¸‹çš„å•†å“ï¼š"><a href="#æŸ¥çœ‹åˆ†ç±»ä¸‹çš„å•†å“ï¼š" class="headerlink" title="æŸ¥çœ‹åˆ†ç±»ä¸‹çš„å•†å“ï¼š"></a>æŸ¥çœ‹åˆ†ç±»ä¸‹çš„å•†å“ï¼š</h4><p>- </p>
<h3 id="è¯„è®ºç›¸å…³"><a href="#è¯„è®ºç›¸å…³" class="headerlink" title="è¯„è®ºç›¸å…³"></a>è¯„è®ºç›¸å…³</h3><h4 id="æ·»åŠ è¯„è®ºï¼š"><a href="#æ·»åŠ è¯„è®ºï¼š" class="headerlink" title="æ·»åŠ è¯„è®ºï¼š"></a>æ·»åŠ è¯„è®ºï¼š</h4><p>- </p>
<h4 id="è·å–å•†å“è¯„è®º"><a href="#è·å–å•†å“è¯„è®º" class="headerlink" title="è·å–å•†å“è¯„è®º"></a>è·å–å•†å“è¯„è®º</h4><p>- </p>
<h4 id="åˆ é™¤è¯„è®ºï¼ˆä¼šåŒæ—¶åˆ é™¤ç‚¹èµæˆ–ç‚¹è¸©è®°å½•ï¼‰ï¼š"><a href="#åˆ é™¤è¯„è®ºï¼ˆä¼šåŒæ—¶åˆ é™¤ç‚¹èµæˆ–ç‚¹è¸©è®°å½•ï¼‰ï¼š" class="headerlink" title="åˆ é™¤è¯„è®ºï¼ˆä¼šåŒæ—¶åˆ é™¤ç‚¹èµæˆ–ç‚¹è¸©è®°å½•ï¼‰ï¼š"></a>åˆ é™¤è¯„è®ºï¼ˆä¼šåŒæ—¶åˆ é™¤ç‚¹èµæˆ–ç‚¹è¸©è®°å½•ï¼‰ï¼š</h4><p>- </p>
<h4 id="ç‚¹èµä¸ç‚¹è¸©ï¼ˆå¯¹è¯„è®ºï¼‰ï¼š"><a href="#ç‚¹èµä¸ç‚¹è¸©ï¼ˆå¯¹è¯„è®ºï¼‰ï¼š" class="headerlink" title="ç‚¹èµä¸ç‚¹è¸©ï¼ˆå¯¹è¯„è®ºï¼‰ï¼š"></a>ç‚¹èµä¸ç‚¹è¸©ï¼ˆå¯¹è¯„è®ºï¼‰ï¼š</h4><p>- </p>
<h3 id="è´­ç‰©è½¦ç›¸å…³"><a href="#è´­ç‰©è½¦ç›¸å…³" class="headerlink" title="è´­ç‰©è½¦ç›¸å…³"></a>è´­ç‰©è½¦ç›¸å…³</h3><h4 id="å•†å“åŠ å…¥è´­ç‰©è½¦ï¼š"><a href="#å•†å“åŠ å…¥è´­ç‰©è½¦ï¼š" class="headerlink" title="å•†å“åŠ å…¥è´­ç‰©è½¦ï¼š"></a>å•†å“åŠ å…¥è´­ç‰©è½¦ï¼š</h4><p>- </p>
<h4 id="ä»è´­ç‰©è½¦åˆ é™¤"><a href="#ä»è´­ç‰©è½¦åˆ é™¤" class="headerlink" title="ä»è´­ç‰©è½¦åˆ é™¤"></a>ä»è´­ç‰©è½¦åˆ é™¤</h4><p>- </p>
<h3 id="è®¢å•ç›¸å…³"><a href="#è®¢å•ç›¸å…³" class="headerlink" title="è®¢å•ç›¸å…³"></a>è®¢å•ç›¸å…³</h3><h4 id="ä¸‹å•"><a href="#ä¸‹å•" class="headerlink" title="ä¸‹å•"></a>ä¸‹å•</h4><p>- </p>
<h4 id="åˆ é™¤è®¢å•"><a href="#åˆ é™¤è®¢å•" class="headerlink" title="åˆ é™¤è®¢å•"></a>åˆ é™¤è®¢å•</h4><p>- </p>
<h4 id="æŸ¥çœ‹è®¢å•è¯¦æƒ…"><a href="#æŸ¥çœ‹è®¢å•è¯¦æƒ…" class="headerlink" title="æŸ¥çœ‹è®¢å•è¯¦æƒ…"></a>æŸ¥çœ‹è®¢å•è¯¦æƒ…</h4><p>- </p>
<h2 id="é¡¹ç›®éƒ¨ç½²"><a href="#é¡¹ç›®éƒ¨ç½²" class="headerlink" title="é¡¹ç›®éƒ¨ç½²"></a>é¡¹ç›®éƒ¨ç½²</h2><ul>
<li><p>ç¡®ä¿å·²å®‰è£…Goç¯å¢ƒã€MySQLæ•°æ®åº“</p>
</li>
<li><p>é€šè¿‡ go getå‘½ä»¤è·å–go-cacheåº“åŠä¾èµ–</p>
</li>
<li><p>åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤å¯åŠ¨æœåŠ¡ï¼š</p>
</li>
</ul>
<pre><code class="bash">go run cmd.go
</code></pre>
<h2 id="ç‰¹åˆ«è¯´æ˜"><a href="#ç‰¹åˆ«è¯´æ˜" class="headerlink" title="ç‰¹åˆ«è¯´æ˜"></a>ç‰¹åˆ«è¯´æ˜</h2><p>â€‹	é¡¹ç›®æ˜¯ä»é›¶å¼€å§‹ä¸€ä¸ªäººæ²¡æ—¥æ²¡å¤œèµ¶åœ¨è¿‡å¹´å‰å®Œæˆçš„ï¼Œç¼“å­˜æ˜¯åšå®Œåå†åŠ çš„å®åœ¨æ˜¯ä¸æƒ³æ”¹äº†ï¼Œåªåœ¨æœç´¢å•†å“ç«¯å£åŠ äº†ï¼Œè¿™ä¸ªæ—¶å€™æ‰å‘ç°å•†å“çš„is_addedCartåœ¨æœ‰æ— tokenæ—¶æœ‰å˜åŒ–ï¼Œäºæ˜¯å¯ä»¥çœ‹åˆ°æˆ‘æœç´¢å•†å“ç«¯å£å†™äº†æœ‰tokenå’Œæ²¡æœ‰tokençš„æ–¹æ³•ï¼Œæ ¹æ®tokenå¾—åˆ°ä¸¤ä¸ªç»“æœï¼ŒåŒç†å•†å“ç›¸å…³çš„ç«¯å£éƒ½è¦æ”¹ï¼Œä½†æ˜¯æˆ‘å®åœ¨ä¸æƒ³æ”¹äº†ï¼Œå°±è¿™æ ·äº†ï¼Œä¹Ÿè¿˜æ˜¯èƒ½è¡Œ</p>
<p>æœåŠ¡å¯åŠ¨åï¼Œé»˜è®¤ç›‘å¬åœ¨  <a target="_blank" rel="noopener" href="http://localhost:8080/">http://localhost:8080</a> ã€‚</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/01/26/RedRock_commerce/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>

<div class="post">
    <a href="/2025/01/22/my%20first%20blog/">
        <h2 class="post-title">my first blog</h2>
    </a>
    <div class="category-and-date">
        
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2025/1/22
        </span>
        
        
    </div>
    <div class="description">
        <div class="content" v-pre>
            
            <p>ğŸ˜ŠğŸ˜ŠğŸ˜Š<br>æäº†ä¸€æ•´å¤©ï¼Œç»ˆäºæ­å¥½äº†ï¼Œæœ¬æ¥æ‰“ç®—æ­åœ¨giteeä¸Šï¼Œç»“æœé‚£è¾¹çš„ä¸€ä¸ªæœåŠ¡çªç„¶åœäº†ï¼Œåªæœ‰ä»˜è´¹çš„ï¼Œæ²¡åŠæ³•åªèƒ½ç”¨GitHubäº†ã€‚<br>å†™è¿™ä¸ªä¸œè¥¿ç°åœ¨è¿˜æœ‰ç‚¹éº»çƒ¦ï¼ŒMarkdownè¿˜ä¸€ç‚¹éƒ½ä¸ä¼šï¼Œæ€»ä¹‹æ‰åˆšåˆšå»ºå¥½ï¼Œæ…¢æ…¢æ‰¾ä¸ªå¥½ä¸€ç‚¹çš„markdownç¼–è¾‘å™¨ï¼Œæˆ‘è¿˜åœ¨ç”¨è®°äº‹æœ¬ï¼Œè¿™ä¸œè¥¿è¿˜æ˜¯ä¸è¡Œã€‚</p>

            
        </div>
    </div>
    <div class="post-tags">
        
        
        
    </div>
    <a href="/2025/01/22/my%20first%20blog/" class="go-post">é˜…è¯»å…¨æ–‡</a>
</div>


        <div class="page-current">
    
    <span class="current">1</span>
    
    
    
    
</div>

    </div>
    
    <div id="home-card">
        <div id="card-style">
    <div id="card-div">
        <div class="avatar">
            <img src="/images/ly.jpg" alt="avatar" />
        </div>
        <div class="name">xkiven</div>
        <div class="description">
            <p>here is kivenâ€¦<br>â€¦</p>

        </div>
        
        
    </div>
</div>

    </div>
    
</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2025 xkiven ã® å°å±‹
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;xkiven
        </div>
        <div>
            Based on the <a target="_blank" rel="noopener" href="https://hexo.io">Hexo Engine</a> &amp;
            <a target="_blank" rel="noopener" href="https://github.com/theme-particlex/hexo-theme-particlex">ParticleX Theme</a>
        </div>
        
    </div>
</footer>

        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
</body>
</html>
